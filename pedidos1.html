<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Resumen del Día</title>
<link rel="stylesheet" href="style.css">
<script src="theme.js" defer></script>
<style>
  body { font-family: sans-serif; background: var(--bg,#f0f0f0); color: var(--text,#000); }
  header { display:flex; justify-content:space-between; align-items:center; padding:15px; background: linear-gradient(135deg,#4facfe,#00f2fe); color:white; font-size:1.2em; }
  header button { background:none; border:none; cursor:pointer; font-size:1.2em; }
  .container { padding:20px; max-width:700px; margin:auto; }
  h2 { margin-bottom:15px; }
  .card { background:#fff; border-radius:10px; padding:15px; margin-bottom:10px; box-shadow:0 4px 10px rgba(0,0,0,0.1); }
  .card h3 { margin:0 0 10px 0; }
  .btn-small { background:#4facfe; color:white; border:none; border-radius:6px; padding:4px 8px; margin-left:5px; cursor:pointer; font-weight:600; transition:0.25s; }
  .btn-small:hover { transform:scale(1.05); }
</style>
</head>
<body>

<header>
  &#x1F4E6; Pedidos del Día
  <button onclick="toggleTheme()">&#x1F319;/&#x2600;</button>
</header>

<div class="container">
  <div id="resumenDia"></div>
</div>

<nav class="navbar">
  <a href="index.html">&#x1F3E0; Inicio</a>
  <a href="clientes.html">&#x1F465; Clientes</a>
  <a href="productos.html">&#x1F4E6; Productos</a>
  <a href="pedidos.html">&#x1F4DD; Pedidos</a>
  <a href="cuentas.html">&#x1F4B0; Cuentas</a>
  <a href="historial.html">&#x1F4DC; Historial</a>
</nav>

<script>
// ======== Helpers ========
function obtenerPedidos(){ return JSON.parse(localStorage.getItem("pedidos"))||[]; }

// ======== Mostrar Pedidos del Día ========
function mostrarPedidosDia(){
  let hoy = new Date().toLocaleDateString();
  let pedidos = obtenerPedidos().filter(p => p.fecha === hoy);
  let resumenDiv = document.getElementById("resumenDia");
  resumenDiv.innerHTML = "";

  // Agrupar por cliente
  let clientes = {};
  pedidos.forEach(p => {
    if(!clientes[p.cliente]) clientes[p.cliente] = [];
    clientes[p.cliente].push(p);
  });

  Object.keys(clientes).forEach(nombre => {
    let card = document.createElement("div");
    card.className = "card";
    card.innerHTML = `<h3>${nombre}</h3>`;
    clientes[nombre].forEach((p,i) => {
      card.innerHTML += `${p.producto} (x${p.cantidad}) - Q${p.total} 
        <button class="btn-small" onclick="editarPedido('${nombre}',${i})">&#x270F;&#xFE0F;</button>
        <button class="btn-small" onclick="eliminarPedido('${nombre}',${i})">&#x274C;</button><br>`;
    });
    resumenDiv.appendChild(card);
  });

  if(pedidos.length === 0) resumenDiv.innerHTML = "<p>No hay pedidos para hoy.</p>";
}

// ======== Editar y Eliminar Pedidos del Día ========
function editarPedido(cliente, indice){
  let pedidos = obtenerPedidos();
  let hoy = new Date().toLocaleDateString();
  let pedidosHoy = pedidos.filter(p => p.cliente===cliente && p.fecha===hoy);
  let pedido = pedidosHoy[indice];
  if(!pedido) return;

  let nuevoTotal = parseFloat(prompt(`Nuevo total para ${pedido.producto}:`, pedido.total));
  if(!isNaN(nuevoTotal) && nuevoTotal>0){
    let globalIndex = pedidos.findIndex(p => p === pedido);
    pedidos[globalIndex].total = nuevoTotal;
    localStorage.setItem("pedidos", JSON.stringify(pedidos));
    mostrarPedidosDia();
  }
}

function eliminarPedido(cliente, indice){
  let pedidos = obtenerPedidos();
  let hoy = new Date().toLocaleDateString();
  let pedidosHoy = pedidos.filter(p => p.cliente===cliente && p.fecha===hoy);
  let pedido = pedidosHoy[indice];
  if(!pedido) return;

  if(confirm("¿Eliminar este pedido?")){
    let globalIndex = pedidos.findIndex(p => p === pedido);
    pedidos.splice(globalIndex,1);
    localStorage.setItem("pedidos", JSON.stringify(pedidos));
    mostrarPedidosDia();
  }
}

// ======== Inicializar ========
document.addEventListener("DOMContentLoaded", mostrarPedidosDia);
</script>

</body>
</html>
